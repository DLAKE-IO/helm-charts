# Default values for bookstack.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of BookStack replicas to deploy (currently only 1 is supported without shared storage)
replicaCount: 1

# -- Deployment strategy configuration
# @default -- `{}` (defaults to RollingUpdate)
deploymentStrategy: {}
# Uncomment for Recreate strategy (recommended if not using shared storage):
#  type: Recreate

image:
  # -- BookStack image repository
  repository: solidnerd/bookstack
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Overrides the image tag (defaults to chart appVersion)
  tag: ""

# -- Image pull secrets for private registries
imagePullSecrets: []

# -- Override the name of the chart
nameOverride: ""

# -- Override the full name of the release
fullnameOverride: ""

serviceAccount:
  # -- Specifies whether a ServiceAccount should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the ServiceAccount to use (auto-generated if not set and create is true)
  name: ""

# -- Annotations to add to the deployment
deploymentAnnotations: {}

# -- Annotations to add to the pod
podAnnotations: {}

# -- Pod-level security context
podSecurityContext:
  fsGroup: 33  # www-data
  runAsNonRoot: true
  runAsUser: 33

# -- Container-level security context
containerSecurityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 33
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false  # BookStack needs write access to certain directories

service:
  # -- Kubernetes service type
  type: ClusterIP
  # -- Service port
  port: 80
  # -- Annotations to add to the service
  annotations: {}

ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name (e.g., "nginx")
  className: ""
  # -- Ingress annotations
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  # -- Ingress path
  path: /
  # -- Ingress path type
  pathType: ImplementationSpecific
  # -- Ingress hostnames
  hosts:
    - bookstack.example.local
  # -- Ingress TLS configuration
  tls: []
  #  - secretName: bookstack-tls
  #    hosts:
  #      - bookstack.example.local

# -- Resource limits and requests
resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 1000m
  #   memory: 512Mi
  # requests:
  #   cpu: 100m
  #   memory: 256Mi

# -- Liveness probe configuration
livenessProbe:
  httpGet:
    path: /status
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

# -- Readiness probe configuration
readinessProbe:
  httpGet:
    path: /status
    port: http
  initialDelaySeconds: 15
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# -- Startup probe configuration
startupProbe:
  httpGet:
    path: /status
    port: http
  initialDelaySeconds: 0
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

# -- Node selector for pod assignment
nodeSelector: {}

# -- Tolerations for pod assignment
tolerations: []

# -- Affinity rules for pod assignment
affinity: {}

app:
  # -- Laravel APP_KEY (required). Generate with: php artisan key:generate --show
  # @default -- "" (must be provided)
  key: ""
  # -- Application URL (required). Must match ingress host or service URL
  url: ""
  # -- Name of existing secret containing APP_KEY (key: app-key)
  # If set, app.key is ignored
  existingSecret: ""

# -- Additional environment variables (deprecated, use extraEnv instead)
env: {}

# -- Extra environment variables to add to the container (list format)
# @default -- `[]`
extraEnv: []
# - name: CUSTOM_VAR
#   value: "custom_value"
# - name: SECRET_VAR
#   valueFrom:
#     secretKeyRef:
#       name: my-secret
#       key: secret-key

# -- Extra environment variables from ConfigMaps or Secrets
# @default -- `[]`
extraEnvFrom: []
# - configMapRef:
#     name: my-config
# - secretRef:
#     name: my-secret

##
## External database configuration
##
externalDatabase:
  # -- External database host
  host: ""
  # -- External database port
  port: 3306
  # -- External database user
  user: bookstack
  # -- External database password
  password: ""
  # -- External database name
  database: bookstack
  # -- TLS certificate content for secure database connection
  tlsCert: ""
  # -- Name of existing secret containing database password (key: db-password)
  # If set, externalDatabase.password is ignored
  existingSecret: ""
  # -- Name of existing secret containing TLS certificate (key: mysql.cert)
  # If set, externalDatabase.tlsCert is ignored
  existingTlsSecret: ""

##
## MariaDB chart configuration
## ref: https://github.com/bitnami/charts/tree/main/bitnami/mariadb
##
mariadb:
  # -- Enable MariaDB subchart. Set to false to use externalDatabase
  enabled: true

  # -- MariaDB architecture (standalone or replication)
  architecture: standalone

  auth:
    # -- MariaDB database name
    database: bookstack
    # -- MariaDB database user
    username: bookstack
    # -- MariaDB user password (auto-generated if not specified)
    password: ""
    # -- MariaDB root password (auto-generated if not specified)
    rootPassword: ""

  primary:
    persistence:
      # -- Enable persistence for MariaDB
      enabled: false
      # -- Storage class for MariaDB PVC
      # @default -- `""` (use cluster default)
      storageClass: ""
      # -- Access mode for MariaDB PVC
      accessModes:
        - ReadWriteOnce
      # -- Size of MariaDB PVC
      size: 8Gi

##
## RBAC configuration
##
rbac:
  # -- Create RBAC resources (Role and RoleBinding)
  # Note: The default RBAC permissions may not be necessary for BookStack.
  # Consider setting this to false unless you have a specific use case.
  create: true

##
## Persistence configuration
##
persistence:
  # Persistence for the public/uploads folder
  uploads:
    # -- Enable persistence for uploads
    enabled: true
    # -- Use existing PVC for uploads
    existingClaim: ""
    # -- Storage class for uploads PVC
    # @default -- `""` (use cluster default)
    storageClass: ""
    # -- Access mode for uploads PVC
    accessMode: ReadWriteOnce
    # -- Size of uploads PVC
    size: 8Gi
    # -- Annotations for uploads PVC
    annotations: {}

  # Persistence for the storage/uploads folder
  storage:
    # -- Enable persistence for storage
    enabled: true
    # -- Use existing PVC for storage
    existingClaim: ""
    # -- Storage class for storage PVC
    # @default -- `""` (use cluster default)
    storageClass: ""
    # -- Access mode for storage PVC
    accessMode: ReadWriteOnce
    # -- Size of storage PVC
    size: 8Gi
    # -- Annotations for storage PVC
    annotations: {}

##
## LDAP authentication configuration
## ref: https://www.bookstackapp.com/docs/admin/ldap-auth/
##
ldap:
  # -- Enable LDAP authentication
  enabled: false
  # -- LDAP server address (e.g., "ldap://ldap.example.com:389")
  server: ""
  # -- LDAP base DN (e.g., "dc=example,dc=com")
  base_dn: ""
  # -- LDAP bind DN (e.g., "cn=admin,dc=example,dc=com")
  dn: ""
  # -- LDAP bind password (stored in Kubernetes Secret)
  pass: ""
  # -- LDAP user filter (e.g., "(&(uid=${user}))")
  userFilter: ""
  # -- LDAP protocol version (usually "3")
  version: ""

##
## Pod Disruption Budget
##
podDisruptionBudget:
  # -- Enable PodDisruptionBudget
  enabled: false
  # -- Minimum available pods during disruption
  minAvailable: 1
  # -- Maximum unavailable pods during disruption (alternative to minAvailable)
  # maxUnavailable: 1

##
## Network Policy
##
networkPolicy:
  # -- Enable NetworkPolicy
  enabled: false
  ingress:
    # -- Pod selector for ingress traffic
    podSelector: {}
    # -- Namespace selector for ingress traffic
    namespaceSelector: {}
  egress:
    # -- Additional egress rules
    extraRules: []
